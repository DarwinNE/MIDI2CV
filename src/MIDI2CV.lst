gpasm-0.13.2 beta               MIDI2CV.asm 1-1-2001  14:55:43           PAGE  1


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               00001 ; *****************************************************************************         
               00002 ;               MIDI2CV.asm
               00003 ;       A MIDI to continuous voltage converter using a PIC16F876
               00004 ;       Davide Bucci, 2004-2012
               00005 ;       Version 1.1
               00006 ; *****************************************************************************
               00007 ;
               00008 ;License:
               00009 ; --------
               00010 ;
               00011 ;    Copyright (C) 2004-2012  Davide Bucci  davbucciPleasenospamherE@tiscali.it
               00012 ;
               00013 ;    This program is free software; you can redistribute it and/or modify
               00014 ;    it under the terms of the GNU General Public License as published by
               00015 ;    the Free Software Foundation; either version 2 of the License, or
               00016 ;    (at your option) any later version.
               00017 ;
               00018 ;    This program is distributed in the hope that it will be useful,
               00019 ;    but WITHOUT ANY WARRANTY; without even the implied warranty of
               00020 ;    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
               00021 ;    GNU General Public License for more details.
               00022 ;
               00023 ;    You should have received a copy of the GNU General Public License
               00024 ;    along with this program; if not, write to the Free Software
               00025 ;    Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
               00026 
               00027         PROCESSOR 16F876
               00028         ERRORLEVEL -302         ; disable the annoying warning 
               00029                                 ; "Register in operand not in bank 0. 
               00030                                 ; Ensure bank bits are correct."
               00031 
               00032 
               00033         #include "p16f876.inc"
               00001         LIST
               00002 ; P16F876.INC  Standard Header File, Version 1.00    Microchip Technology, Inc.
               00359         LIST
002007 3F7A    00034         __CONFIG 0x3F7A         ; Disable watchdog, HS oscillator, 
               00035                                 ; disable LT programming
               00036 
               00037 ; These registers are accessible in all pages
  00000070     00038 STORES  equ     70      ; Store status register
  00000071     00039 STOREW  equ     71      ; Store the w register
  00000072     00040 STOREP  equ     72      ; Store the PCLATH register
               00041 
  00000025     00042 CHANNEL equ     25      ; Channel number
  00000026     00043 TRNSM   equ     26      ; Transmission status (See TRN section)
  00000027     00044 RECBYTE equ     27      ; Received byte (used in interrupt)
               00045 
  00000028     00046 ST      equ     28      ; State of the MIDI reception state machine
               00047 
  00000020     00048 DISP0   equ     20      ; First display
  00000021     00049 DISP1   equ     21      ; Second display
  00000022     00050 ACTDISP equ     22      ; Actual display being refreshed
  00000023     00051 LEDST   equ     23      ; LED state
gpasm-0.13.2 beta               MIDI2CV.asm 1-1-2001  14:55:43           PAGE  2


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               00052 
  00000000     00053 TRN_RXF equ     0       ; Error: reception buffer full
  00000001     00054 TRN_FRM equ     1       ; Error: reception without a stop bit (frame error)
               00055 
               00056 ; These registers controls the buttons
  0000002A     00057 BUTTONS equ     2A      
  00000000     00058 SET_B   equ     0
  00000001     00059 CHNG_B  equ     1
  0000002B     00060 OLD_BTN equ     2B
  0000002C     00061 ACT_BTN equ     2C
  0000002D     00062 TMP_1   equ     2D
               00063 
  00000030     00064 SDR     equ     30      ; Short Delay Register
  00000031     00065 LDR     equ     31      ; Long Delay Register
  00000032     00066 NOTE_PL equ     32
               00067 
               00068 
               00069 ; *****************************************************************************         
               00070 ;               Main Program
               00071 ; *****************************************************************************         
0000           00072                 org     0000
               00073         
0000 2810      00074                 goto    prg
0001 0000      00075                 nop     
0002 0000      00076                 nop
0003 0000      00077                 nop
0004           00078                 org     0004
0004 289C      00079                 goto    interrupt
0005           00080 segment 
0005 0782      00081                 addwf   PCL,f          ;return into W the right set of segments
0006 343F      00082                 retlw   0x3F           ;to be turned on for each digit
0007 3406      00083                 retlw   0x06
0008 345B      00084                 retlw   0x5B
0009 344F      00085                 retlw   0x4F
000A 3466      00086                 retlw   0x66
000B 346D      00087                 retlw   0x6D            
000C 347C      00088                 retlw   0x7C
000D 3407      00089                 retlw   0x07
000E 347F      00090                 retlw   0x7F
000F 3467      00091                 retlw   0x67
               00092 
0010           00093 prg             
0010 1683 1303 00094                 BANKSEL ADCON1
0012 3006      00095                 movlw   0x06
0013 009F      00096                 movwf   ADCON1  ; Disable the ADC on port A
0014 018B      00097                 clrf    INTCON
               00098 
0015 1683 1303 00099                 BANKSEL TRISC
0017 1107      00100                 bcf     TRISC, 2        ; PWM1
0018 1087      00101                 bcf     TRISC, 1        ; PWM2  ############
0019 1187      00102                 bcf     TRISC, 3        ; mux 1
001A 1207      00103                 bcf     TRISC, 4        ; mux 2
001B 1287      00104                 bcf     TRISC, 5        ; mux 4
001C 1007      00105                 bcf     TRISC, 0        ; Gate 1 
gpasm-0.13.2 beta               MIDI2CV.asm 1-1-2001  14:55:43           PAGE  3


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
001D 1087      00106                 bcf     TRISC, 1        ; Gate 2 
001E 1283 1303 00107                 BANKSEL PORTB
               00108 
               00109                 ; ************************************************************* 
               00110                 ; UART settings for MIDI transmission
               00111                 ; *************************************************************
0020 1283 1303 00112                 BANKSEL TRNSM
0022 01A6      00113                 clrf    TRNSM           ; Clear the transmission error register
               00114 
0023 3027      00115                 movlw   0x27            ; Set transmission speed (31250 bauds 
               00116                                         ; for a 20MHz crystal)
0024 1683 1303 00117                 BANKSEL SPBRG
0026 0099      00118                 movwf   SPBRG
0027 1683 1303 00119                 BANKSEL TXSTA
               00120                 
0029 1318      00121                 bcf     TXSTA, TX9      ; 8 bits transmission
002A 1218      00122                 bcf     TXSTA, SYNC     ; Asynchronous mode
002B 1518      00123                 bsf     TXSTA, BRGH     ; High speed mode
002C 1698      00124                 bsf     TXSTA, TXEN     ; Enable transmission
               00125 
002D 1683 1303 00126                 BANKSEL PIE1
002F 168C      00127                 bsf     PIE1, RCIE      ; Use interrupt driven reception
0030 1283 1303 00128                 BANKSEL RCSTA
0032 1798      00129                 bsf     RCSTA, SPEN     ; Serial port enabled
0033 1318      00130                 bcf     RCSTA, RX9      ; 8 bits reception
0034 1618      00131                 bsf     RCSTA, CREN     ; Continous receive on
0035 1198      00132                 bcf     RCSTA, ADDEN
0036 1118      00133                 bcf     RCSTA, FERR
               00134 
0037 170B      00135                 bsf     INTCON, PEIE    ; Set USART interrupt enable            
               00136                 ; ************************************************************* 
               00137                 ; PWM settings
               00138                 ; *************************************************************
               00139                 
0038 1283 1303 00140                 BANKSEL CCP1CON
               00141 
003A 0197      00142                 clrf    CCP1CON
               00143 
003B 3004      00144                 movlw   0x04            ; 0b00000100 prescaler 1:1 tmr oN
003C 0092      00145                 movwf   T2CON
               00146 
003D 300C      00147                 movlw   0x0C            ; Configure PWM1
003E 0097      00148                 movwf   CCP1CON
003F 3000      00149                 movlw   0x00            ; Do not use PWM2
0040 009D      00150                 movwf   CCP2CON
               00151 
0041 30FE      00152                 movlw   0xFE
0042 1683 1303 00153                 BANKSEL PR2     
0044 0092      00154                 movwf   PR2
0045 1283 1303 00155                 BANKSEL T2CON
               00156                 
0047 3080      00157                 movlw   0x80
0048 0095      00158                 movwf   CCPR1L
0049 009B      00159                 movwf   CCPR2L
gpasm-0.13.2 beta               MIDI2CV.asm 1-1-2001  14:55:43           PAGE  4


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               00160                 
004A 1283 1303 00161                 BANKSEL CHANNEL                 
               00162 
004C 3000      00163                 movlw   0x00    
004D 00A5      00164                 movwf   CHANNEL         ; Set the default channel
               00165                 
004E 1283 1303 00166                 BANKSEL ST
0050 01A8      00167                 clrf    ST              ; Start from the first state
               00168 
               00169 
               00170 
               00171                 ; ************************************************************* 
               00172                 ; Configuration of the display refresh interrupt
               00173                 ; *************************************************************
0051 1683 1303 00174                 BANKSEL TRISB
0053 0186      00175                 clrf    TRISB                   ; Port B as output (display)
0054 1405      00176                 bsf     TRISA, 0                ; Button sense line     
0055 1085      00177                 bcf     TRISA, 1                ; Display 0 ctrl
0056 1105      00178                 bcf     TRISA, 2                ; Display 1 ctrl
               00179                 
0057 1683 1303 00180                 BANKSEL OPTION_REG
0059 1281      00181                 bcf     OPTION_REG, T0CS        ; The clock drives the timer
005A 1181      00182                 bcf     OPTION_REG, PSA         ; We use the prescaler
005B 1501      00183                 bsf     OPTION_REG, PS2         ; 100, prescaler to 1:32
005C 1081      00184                 bcf     OPTION_REG, PS1         
005D 1001      00185                 bcf     OPTION_REG, PS0
               00186                 
005E 1283 1303 00187                 BANKSEL INTCON
               00188         
0060 168B      00189                 bsf     INTCON, T0IE            ; Interrupt on TMR0 overflow 
               00190 
0061 178B      00191                 bsf     INTCON, GIE             ; Set Global Interrupt enable
               00192                 ; ************************************************************* 
               00193                 ; End of setup! Main program begins here.
               00194                 ; *************************************************************
0062 1283 1303 00195                 BANKSEL DISP0
0064 3001      00196                 movlw   0x01
0065 00A0      00197                 movwf   DISP0
0066 3002      00198                 movlw   0x02
0067 00A1      00199                 movwf   DISP1
0068 30FF      00200                 movlw   0xFF                    ; No note being played
0069 00B2      00201                 movwf   NOTE_PL
               00202 
               00203 
               00204                 
006A           00205 continue
006A 208E      00206                 call    chnl2disp
006B 2074      00207                 call    wait_buttons
006C 182C      00208                 btfsc   ACT_BTN, SET_B
006D 10A3      00209                 bcf     LEDST,1                 ; Note on LED
006E 0AA5      00210                 incf    CHANNEL,f
006F 0825      00211                 movfw   CHANNEL
0070 3A10      00212                 xorlw   0x10
0071 1903      00213                 btfsc   STATUS,Z
gpasm-0.13.2 beta               MIDI2CV.asm 1-1-2001  14:55:43           PAGE  5


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
0072 01A5      00214                 clrf    CHANNEL
               00215                 
0073 286A      00216                 goto    continue
               00217 
0074           00218 wait_buttons                            ; Wait until a button is pressed; 
               00219                                         ; return the button code in w and in 
               00220                                         ; OLD_BTN
               00221         
0074 3020      00222                 movlw   0x20            ; Set the delay duration
0075 00B1      00223                 movwf   LDR             
0076 2083      00224                 call    longdelay
0077           00225 button_loop                             ; Main loop
0077 082C      00226                 movfw   ACT_BTN         ; Save the old state of the buttons
0078 00AB      00227                 movwf   OLD_BTN
0079 082A      00228                 movfw   BUTTONS         ; Save the new state of the buttons
007A 00AC      00229                 movwf   ACT_BTN
007B 062B      00230                 xorwf   OLD_BTN,w       ; Verify if there was a change in the 
007C 1903      00231                 btfsc   STATUS, Z       ; button status
007D 2877      00232                 goto    button_loop
007E 182C      00233                 btfsc   ACT_BTN, SET_B  ; Test the set button
007F 3400      00234                 retlw   SET_B
0080 18AC      00235                 btfsc   ACT_BTN, CHNG_B ; Test the change button
0081 3401      00236                 retlw   CHNG_B
0082 2874      00237                 goto    wait_buttons
               00238 
0083           00239 longdelay
0083 1283 1303 00240                 BANKSEL LDR
0085 2089      00241                 call    shortdelay
0086 0BB1      00242                 decfsz  LDR,f
0087 2883      00243                 goto    longdelay
0088 0008      00244                 return
               00245                 
0089           00246 shortdelay      
0089 1283 1303 00247                 BANKSEL SDR
008B 0BB0      00248                 decfsz  SDR,f
008C 2889      00249                 goto    shortdelay
008D 0008      00250                 return
               00251 
008E 0825      00252 chnl2disp       movfw   CHANNEL
008F 3E01      00253                 addlw   0x01            ; Channels are shown as 1-16
0090 3EF6      00254                 addlw   -0x0A           ; Test if it is >10
0091 1C03      00255                 btfss   STATUS, C
0092 2897      00256                 goto    lt10
0093 00A1      00257                 movwf   DISP1
0094 3001      00258                 movlw   0x01
0095 00A0      00259                 movwf   DISP0
0096 0008      00260                 return
0097 3E0A      00261 lt10            addlw   0x0A
0098 00A1      00262                 movwf   DISP1
0099 3000      00263                 movlw   0x00
009A 00A0      00264                 movwf   DISP0
009B 0008      00265                 return
               00266 
               00267 ; *****************************************************************************         
gpasm-0.13.2 beta               MIDI2CV.asm 1-1-2001  14:55:43           PAGE  6


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               00268 ;               Interrupt routine. Most of interesting stuff happens here.
               00269 ; *****************************************************************************         
               00270 
009C           00271 interrupt       
009C 00F1      00272                 movwf   STOREW                  ; Context save
009D 0803      00273                 movfw   STATUS
009E 00F0      00274                 movwf   STORES
009F 080A      00275                 movfw   PCLATH
00A0 00F2      00276                 movwf   STOREP
               00277                 
               00278 
00A1           00279 charloop        
00A1 1283 1303 00280                 BANKSEL PIR1                    ; Loop until there is a 
               00281                                                 ; character in the buffer
00A3 1E8C      00282                 btfss   PIR1, RCIF              ; Character received?
00A4 2924      00283                 goto    continueint             ; All characters processed
               00284                 
               00285                 ; ************************************************************* 
               00286                 ; Process MIDI messages
               00287                 ; *************************************************************
               00288         
00A5 1283 1303 00289                 BANKSEL RCREG   
00A7 081A      00290                 movfw   RCREG                   ; Read character
               00291 
               00292                 ; Recognise the start of a MIDI message is a pretty easy task
               00293                 ; if we note that it's the only byte in the transmission having
               00294                 ; the MSB set. The following bytes will be treated as part of 
               00295                 ; the same message.
               00296                 ; In all MIDI message, the higher four bits in the first byte 
               00297                 ; specif the message type and the four lower bits the channel.
               00298                 ; In our case, we simply read the channel to toggle between 
               00299                 ; ports.
               00300                 
00A8 1283 1303 00301                 BANKSEL RECBYTE                 ; Save the received byte 
               00302                                                 ; (same bank as PORTC)
00AA 00A7      00303                 movwf   RECBYTE
               00304 
00AB 0828      00305                 movfw   ST                      ; MIDI state machine
00AC 0782      00306                 addwf   PCL,f                   ; Select the state
00AD 28B4      00307                 goto    idle                    ; 0
00AE 28D2      00308                 goto    note_on_k               ; 1             
00AF 28E2      00309                 goto    note_on_v               ; 2
00B0 28E8      00310                 goto    note_off_k              ; 3
00B1 28F5      00311                 goto    note_off_v              ; 4
00B2 28FE      00312                 goto    control_c               ; 5
00B3 2909      00313                 goto    control_v               ; 6
               00314 
               00315 
00B4 1FA7      00316 idle            btfss   RECBYTE, 7              ; Test the M.S. byte
00B5 291D      00317                 goto    skip                    ; Is not a MIDI message header
               00318                 
               00319                 ; This code is executed only for the MIDI message header.
               00320                 ; In this place we should recognise the channel 
00B6 0827      00321                 movfw   RECBYTE
gpasm-0.13.2 beta               MIDI2CV.asm 1-1-2001  14:55:43           PAGE  7


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
00B7 390F      00322                 andlw   0x0F                    ; Separate the channel number
00B8 0625      00323                 xorwf   CHANNEL,w               ; Test if it is "our" channel
00B9 1D03      00324                 btfss   STATUS, Z       
00BA 291D      00325                 goto    skip
00BB 0827      00326                 movfw   RECBYTE
               00327                 ; Now we determine the event. Only two event are detected here:
               00328                 ; Note on and Note off
00BC 39F0      00329                 andlw   0xF0                    ; Determine the event
00BD 3A90      00330                 xorlw   0x90                    
00BE 1D03      00331                 btfss   STATUS,Z                ; note on
00BF 28C3      00332                 goto    no_note_on
00C0 3001      00333                 movlw   0x01                    ; state 1: note_on_k
00C1 00A8      00334                 movwf   ST      
00C2 291D      00335                 goto    skip
00C3 0827      00336 no_note_on      movfw   RECBYTE
00C4 39F0      00337                 andlw   0xF0                    ; Determine the event
00C5 3A80      00338                 xorlw   0x80                    
00C6 1D03      00339                 btfss   STATUS,Z                ; note off              
00C7 28CA      00340                 goto    no_note_off             
00C8 3003      00341                 movlw   0x03                    ; state 3: note_off_k
00C9 00A8      00342                 movwf   ST
00CA 0827      00343 no_note_off     movfw   RECBYTE
00CB 39F0      00344                 andlw   0xF0                    ; Determine the event
00CC 3AB0      00345                 xorlw   0xB0                    
00CD 1D03      00346                 btfss   STATUS,Z                ; control               
00CE 28D1      00347                 goto    no_control              
00CF 3005      00348                 movlw   0x05                    ; state 5: control_on_k
00D0 00A8      00349                 movwf   ST
               00350 
00D1           00351 no_control      
00D1 291D      00352                 goto    skip
               00353 
               00354 
00D2 1283 1303 00355 note_on_k       BANKSEL LEDST
00D4 14A3      00356                 bsf     LEDST,1                 ; Note on LED
               00357                 ;movfw  NOTE_PL
               00358                 ;xorlw  0xFF                    ; Is a note being played?
               00359                 ;btfss  SATUS,Z
               00360                 ;goto   noplaying               
00D5 1283 1303 00361                 BANKSEL PORTC                   ; if a note is being played
00D7 1007      00362                 bcf     PORTC, 0                ; gate 1 OFF
00D8 1283 1303 00363 noplaying       BANKSEL RECBYTE
00DA 0827      00364                 movfw   RECBYTE 
00DB 0DA7      00365                 rlf     RECBYTE,f               ; 128 semitones!
00DC 0095      00366                 movwf   CCPR1L                  ; Set PWM               
00DD 009B      00367                 movwf   CCPR2L
00DE 00B2      00368                 movwf   NOTE_PL                 ; Store NOTE being played
               00369         
00DF 3002      00370                 movlw   0x02                    ; state 2: note_on_v
00E0 00A8      00371                 movwf   ST
00E1 291D      00372                 goto    skip
00E2           00373 note_on_v       
00E2 3000      00374                 movlw   0x00                    ; state 0: idle
00E3 00A8      00375                 movwf   ST
gpasm-0.13.2 beta               MIDI2CV.asm 1-1-2001  14:55:43           PAGE  8


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
00E4 1283 1303 00376                 BANKSEL PORTC   
00E6 1407      00377                 bsf     PORTC, 0                ; gate 1 On
00E7 291D      00378                 goto    skip
               00379 
00E8           00380 note_off_k              
00E8 3004      00381                 movlw   0x04                    ; state 2: note_on_v
00E9 00A8      00382                 movwf   ST
00EA 1283 1303 00383                 BANKSEL RECBYTE
00EC 0827      00384                 movfw   RECBYTE                 ; read the key
00ED 1283 1303 00385                 BANKSEL NOTE_PL                 ; note played
00EF 0632      00386                 xorwf   NOTE_PL,w
00F0 1903      00387                 btfsc   STATUS,Z
00F1 291D      00388                 goto    skip                    ; The correct note: continue
00F2 3000      00389                 movlw   0x00                    ; An old note: avoid
00F3 00A8      00390                 movwf   ST
00F4 291D      00391                 goto    skip
00F5           00392 note_off_v      
00F5 3000      00393                 movlw   0x00                    ; next state 0: idle
00F6 00A8      00394                 movwf   ST
00F7 1283 1303 00395                 BANKSEL PORTC
00F9 1007      00396                 bcf     PORTC, 0                ; gate 1 OFF
00FA 1283 1303 00397                 BANKSEL LEDST
00FC 10A3      00398                 bcf     LEDST,1                 ; Note on LED
00FD 291D      00399                 goto    skip
               00400 
00FE           00401 control_c
00FE 3000      00402                 movlw   0x00                    ; next state 0: idle
00FF 00A8      00403                 movwf   ST
0100 1283 1303 00404                 BANKSEL RECBYTE
0102 0827      00405                 movfw   RECBYTE 
0103 3A40      00406                 xorlw   0x40                    ; 0x40 is damper pedal control
0104 1D03      00407                 btfss   STATUS, Z
0105 291D      00408                 goto    skip
0106 3006      00409                 movlw   0x06                    ; if a pedal control is rec'd
0107 00A8      00410                 movwf   ST                      ; the next state will be 
0108 291D      00411                 goto    skip                    ; 6, control_v
               00412 
0109           00413 control_v       
0109 3000      00414                 movlw   0x00                    ; next state 0: idle
010A 00A8      00415                 movwf   ST
010B 1283 1303 00416                 BANKSEL RECBYTE
010D 1B27      00417                 btfsc   RECBYTE,6
010E 2916      00418                 goto    gate2_on
010F 1283 1303 00419                 BANKSEL PORTC   
0111 1087      00420                 bcf     PORTC, 1                ; gate 2 Off
0112 1283 1303 00421                 BANKSEL LEDST           
0114 1023      00422                 bcf     LEDST,0
0115 291D      00423                 goto    skip
0116 1283 1303 00424 gate2_on        BANKSEL PORTC                   ; gate 2 On
0118 1487      00425                 bsf     PORTC, 1
0119 1283 1303 00426                 BANKSEL LEDST           
011B 1423      00427                 bsf     LEDST,0
011C 291D      00428                 goto    skip
               00429 
gpasm-0.13.2 beta               MIDI2CV.asm 1-1-2001  14:55:43           PAGE  9


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               00430 
011D 1683 1303 00431 skip            BANKSEL TXSTA
011F 1898      00432                 btfsc   TXSTA, OERR             ; Test for a buffer overrun
0120 214E      00433                 call    error_buffer
0121 1918      00434                 btfsc   TXSTA, FERR             ; Test for a frame error 
0122 2156      00435                 call    error_frame     
0123 28A1      00436                 goto    charloop                ; See if there is another byte          
               00437                                                 ; The RCIF bit is cleared by 
               00438                                                 ; hardware by reading the 
               00439                                                 ; RCREG register
               00440                 ; ************************************************************* 
               00441                 ; Display refresh
               00442                 ; *************************************************************
               00443 
0124 1283 1303 00444 continueint     BANKSEL PIR1                    ; Test if the display need to 
               00445                                                 ; be refreshed
0126 1D0B      00446                 btfss   INTCON, T0IF            ; TMR0 overflow
0127 2948      00447                 goto    exitinterrupt
               00448                 
               00449                 ;btfsc  ACTDISP,1               ; Decrease the display ON time
               00450                 ;goto   switchoff
               00451 
0128 1822      00452                 btfsc   ACTDISP,0               ; Display multiplex
0129 2937      00453                 goto    refresh1
               00454 
012A 1283 1303 00455 refresh0        BANKSEL DISP0
012C 0820      00456                 movfw   DISP0
012D 142A      00457                 bsf     BUTTONS,SET_B
012E 1805      00458                 btfsc   PORTA,0                 ; Test button 1
012F 102A      00459                 bcf     BUTTONS,SET_B
0130 1485      00460                 bsf     PORTA,1         
0131 1105      00461                 bcf     PORTA,2
0132 2005      00462                 call    segment
0133 1823      00463                 btfsc   LEDST,0
0134 3880      00464                 iorlw   0x80
0135 0086      00465                 movwf   PORTB
0136 2946      00466                 goto    contrefresh
0137 1283 1303 00467 refresh1        BANKSEL DISP1
0139 0821      00468                 movfw   DISP1
013A 14AA      00469                 bsf     BUTTONS,CHNG_B
013B 1805      00470                 btfsc   PORTA,0                 ; Test button 0
013C 10AA      00471                 bcf     BUTTONS,CHNG_B
013D 1085      00472                 bcf     PORTA,1
013E 2005      00473                 call    segment
013F 18A3      00474                 btfsc   LEDST,1
0140 3880      00475                 iorlw   0x80
0141 0086      00476                 movwf   PORTB
0142 1505      00477                 bsf     PORTA,2
0143 2946      00478                 goto    contrefresh
0144 1085      00479 switchoff       bcf     PORTA,1                 ; Switch off the two displays
0145 1105      00480                 bcf     PORTA,2
0146 0AA2      00481 contrefresh     incf    ACTDISP,f               ; Change display next time              
0147 110B      00482                 bcf     INTCON, T0IF
               00483 
gpasm-0.13.2 beta               MIDI2CV.asm 1-1-2001  14:55:43           PAGE 10


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
0148           00484 exitinterrupt   
0148 0872      00485                 movfw   STOREP                  ; Context restore
0149 008A      00486                 movwf   PCLATH
014A 0870      00487                 movfw   STORES                  
014B 0083      00488                 movwf   STATUS
014C 0871      00489                 movfw   STOREW
014D 0009      00490                 retfie                          ; Return from interrupt
               00491 
               00492 
               00493                 ; ************************************************************* 
               00494                 ; Serial transmission errors
               00495                 ; *************************************************************
               00496         
               00497 
014E           00498 error_buffer    
014E 1283 1303 00499                 BANKSEL TRNSM                   ; Signal the error condition: 
               00500                                                 ; buffer overrun
0150 1426      00501                 bsf     TRNSM, TRN_RXF  
0151 1283 1303 00502                 BANKSEL RCSTA
0153 1218      00503                 bcf     RCSTA, CREN             ; Continous receive off: 
               00504                                                 ; reset the USART
0154 1618      00505                 bsf     RCSTA, CREN             ; Continous receive on: 
               00506                                                 ; restart the normal way of 
               00507                                                 ; life...
0155 0008      00508                 return
               00509 
0156           00510 error_frame     
0156 1283 1303 00511                 BANKSEL TRNSM                   ; Signal the error condition: 
               00512                                                 ; frame error
0158 14A6      00513                 bsf     TRNSM, TRN_FRM          
0159 1283 1303 00514                 BANKSEL RCSTA
015B 1218      00515                 bcf     RCSTA, CREN             ; Continous receive off: 
               00516                                                 ; reset the USART
015C 1618      00517                 bsf     RCSTA, CREN             ; Continous receive on: 
               00518                                                 ; restart the normal way of 
               00519                                                 ; life...
015D 0008      00520                 return
               00521 
               00522 
gpasm-0.13.2 beta               MIDI2CV.asm 1-1-2001  14:55:43           PAGE 11


SYMBOL TABLE
  LABEL                             VALUE 

ACKDT                             00000005
ACKEN                             00000004
ACKSTAT                           00000006
ACTDISP                           00000022
ACT_BTN                           0000002C
ADCON0                            0000001F
ADCON1                            0000009F
ADCS0                             00000006
ADCS1                             00000007
ADDEN                             00000003
ADFM                              00000007
ADIE                              00000006
ADIF                              00000006
ADON                              00000000
ADRESH                            0000001E
ADRESL                            0000009E
BCLIE                             00000003
BCLIF                             00000003
BF                                00000000
BRGH                              00000002
BUTTONS                           0000002A
C                                 00000000
CCP1CON                           00000017
CCP1IE                            00000002
CCP1IF                            00000002
CCP1M0                            00000000
CCP1M1                            00000001
CCP1M2                            00000002
CCP1M3                            00000003
CCP1X                             00000005
CCP1Y                             00000004
CCP2CON                           0000001D
CCP2IE                            00000000
CCP2IF                            00000000
CCP2M0                            00000000
CCP2M1                            00000001
CCP2M2                            00000002
CCP2M3                            00000003
CCP2X                             00000005
CCP2Y                             00000004
CCPR1H                            00000016
CCPR1L                            00000015
CCPR2H                            0000001C
CCPR2L                            0000001B
CHANNEL                           00000025
CHNG_B                            00000001
CHS0                              00000003
CHS1                              00000004
CHS2                              00000005
CKE                               00000006
CKP                               00000004
CREN                              00000004
CSRC                              00000007
gpasm-0.13.2 beta               MIDI2CV.asm 1-1-2001  14:55:43           PAGE 12


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
D                                 00000005
DATA_ADDRESS                      00000005
DC                                00000001
DISP0                             00000020
DISP1                             00000021
D_A                               00000005
EEADR                             0000010D
EEADRH                            0000010F
EECON1                            0000018C
EECON2                            0000018D
EEDATA                            0000010C
EEDATH                            0000010E
EEIE                              00000004
EEIF                              00000004
EEPGD                             00000007
F                                 00000001
FERR                              00000002
FSR                               00000004
GCEN                              00000007
GIE                               00000007
GO                                00000002
GO_DONE                           00000002
I2C_DATA                          00000005
I2C_READ                          00000002
I2C_START                         00000003
I2C_STOP                          00000004
INDF                              00000000
INTCON                            0000000B
INTE                              00000004
INTEDG                            00000006
INTF                              00000001
IRP                               00000007
LDR                               00000031
LEDST                             00000023
NOTE_PL                           00000032
NOT_A                             00000005
NOT_ADDRESS                       00000005
NOT_BO                            00000000
NOT_BOR                           00000000
NOT_DONE                          00000002
NOT_PD                            00000003
NOT_POR                           00000001
NOT_RBPU                          00000007
NOT_RC8                           00000006
NOT_T1SYNC                        00000002
NOT_TO                            00000004
NOT_TX8                           00000006
NOT_W                             00000002
NOT_WRITE                         00000002
OERR                              00000001
OLD_BTN                           0000002B
OPTION_REG                        00000081
P                                 00000004
PCFG0                             00000000
gpasm-0.13.2 beta               MIDI2CV.asm 1-1-2001  14:55:43           PAGE 13


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
PCFG1                             00000001
PCFG2                             00000002
PCFG3                             00000003
PCL                               00000002
PCLATH                            0000000A
PCON                              0000008E
PEIE                              00000006
PEN                               00000002
PIE1                              0000008C
PIE2                              0000008D
PIR1                              0000000C
PIR2                              0000000D
PORTA                             00000005
PORTB                             00000006
PORTC                             00000007
PR2                               00000092
PS0                               00000000
PS1                               00000001
PS2                               00000002
PSA                               00000003
R                                 00000002
RBIE                              00000003
RBIF                              00000000
RC8_9                             00000006
RC9                               00000006
RCD8                              00000000
RCEN                              00000003
RCIE                              00000005
RCIF                              00000005
RCREG                             0000001A
RCSTA                             00000018
RD                                00000000
READ_WRITE                        00000002
RECBYTE                           00000027
RP0                               00000005
RP1                               00000006
RSEN                              00000001
RX9                               00000006
RX9D                              00000000
R_W                               00000002
S                                 00000003
SDR                               00000030
SEN                               00000000
SET_B                             00000000
SMP                               00000007
SPBRG                             00000099
SPEN                              00000007
SREN                              00000005
SSPADD                            00000093
SSPBUF                            00000013
SSPCON                            00000014
SSPCON2                           00000091
SSPEN                             00000005
SSPIE                             00000003
gpasm-0.13.2 beta               MIDI2CV.asm 1-1-2001  14:55:43           PAGE 14


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
SSPIF                             00000003
SSPM0                             00000000
SSPM1                             00000001
SSPM2                             00000002
SSPM3                             00000003
SSPOV                             00000006
SSPSTAT                           00000094
ST                                00000028
STATUS                            00000003
STOREP                            00000072
STORES                            00000070
STOREW                            00000071
SYNC                              00000004
T0CS                              00000005
T0IE                              00000005
T0IF                              00000002
T0SE                              00000004
T1CKPS0                           00000004
T1CKPS1                           00000005
T1CON                             00000010
T1INSYNC                          00000002
T1OSCEN                           00000003
T1SYNC                            00000002
T2CKPS0                           00000000
T2CKPS1                           00000001
T2CON                             00000012
TMP_1                             0000002D
TMR0                              00000001
TMR1CS                            00000001
TMR1H                             0000000F
TMR1IE                            00000000
TMR1IF                            00000000
TMR1L                             0000000E
TMR1ON                            00000000
TMR2                              00000011
TMR2IE                            00000001
TMR2IF                            00000001
TMR2ON                            00000002
TOUTPS0                           00000003
TOUTPS1                           00000004
TOUTPS2                           00000005
TOUTPS3                           00000006
TRISA                             00000085
TRISB                             00000086
TRISC                             00000087
TRMT                              00000001
TRNSM                             00000026
TRN_FRM                           00000001
TRN_RXF                           00000000
TX8_9                             00000006
TX9                               00000006
TX9D                              00000000
TXD8                              00000000
TXEN                              00000005
gpasm-0.13.2 beta               MIDI2CV.asm 1-1-2001  14:55:43           PAGE 15


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
TXIE                              00000004
TXIF                              00000004
TXREG                             00000019
TXSTA                             00000098
UA                                00000001
W                                 00000000
WCOL                              00000007
WR                                00000001
WREN                              00000002
WRERR                             00000003
Z                                 00000002
_BODEN_OFF                        00003FBF
_BODEN_ON                         00003FFF
_CPD_OFF                          00003FFF
_CPD_ON                           00003EFF
_CP_ALL                           00000FCF
_CP_HALF                          00001FDF
_CP_OFF                           00003FFF
_CP_UPPER_256                     00002FEF
_DEBUG_OFF                        00003FFF
_DEBUG_ON                         000037FF
_HS_OSC                           00003FFE
_LP_OSC                           00003FFC
_LVP_OFF                          00003F7F
_LVP_ON                           00003FFF
_PWRTE_OFF                        00003FFF
_PWRTE_ON                         00003FF7
_RC_OSC                           00003FFF
_WDT_OFF                          00003FFB
_WDT_ON                           00003FFF
_WRT_ENABLE_OFF                   00003DFF
_WRT_ENABLE_ON                    00003FFF
_XT_OSC                           00003FFD
__16F876                          00000001
button_loop                       00000077
charloop                          000000A1
chnl2disp                         0000008E
continue                          0000006A
continueint                       00000124
contrefresh                       00000146
control_c                         000000FE
control_v                         00000109
error_buffer                      0000014E
error_frame                       00000156
exitinterrupt                     00000148
gate2_on                          00000116
idle                              000000B4
interrupt                         0000009C
longdelay                         00000083
lt10                              00000097
no_control                        000000D1
no_note_off                       000000CA
no_note_on                        000000C3
noplaying                         000000D8
gpasm-0.13.2 beta               MIDI2CV.asm 1-1-2001  14:55:43           PAGE 16


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
note_off_k                        000000E8
note_off_v                        000000F5
note_on_k                         000000D2
note_on_v                         000000E2
prg                               00000010
refresh0                          0000012A
refresh1                          00000137
segment                           00000005
shortdelay                        00000089
skip                              0000011D
switchoff                         00000144
wait_buttons                      00000074


MEMORY USAGE MAP ('X' = Used,  '-' = Unused)

00000000 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000040 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000080 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
000000c0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000100 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000140 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXX-- ---------------- ----------------
00002000 : -------X-------- ---------------- ---------------- ----------------

All other memory blocks unused.

Program Memory Words Used: 351


Errors   :       0
Warnings :       0 reported,       0 suppressed
Messages :       0 reported,      26 suppressed

